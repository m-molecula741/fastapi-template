# Шаблон FastAPI проекта на чистой архитектуре

![Python](https://img.shields.io/badge/python-3.13.2+-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.115.11+-green.svg)
![SQLAlchemy](https://img.shields.io/badge/SQLAlchemy-2.0.39+-yellow.svg)
![Pydantic](https://img.shields.io/badge/Pydantic-2.10.6+-orange.svg)

Этот проект представляет собой шаблон веб-приложения, построенного с использованием принципов чистой архитектуры (Clean Architecture).

## Содержание

- [Шаблон FastAPI проекта на чистой архитектуре](#шаблон-fastapi-проекта-на-чистой-архитектуре)
  - [Содержание](#содержание)
  - [Архитектура проекта](#архитектура-проекта)
    - [Преимущества чистой архитектуры](#преимущества-чистой-архитектуры)
    - [Слои архитектуры](#слои-архитектуры)
  - [Структура проекта](#структура-проекта)
  - [Основные функции](#основные-функции)
  - [API Endpoints](#api-endpoints)
    - [Публичные эндпоинты](#публичные-эндпоинты)
    - [Приватные эндпоинты (требуют авторизации)](#приватные-эндпоинты-требуют-авторизации)
  - [Установка и запуск](#установка-и-запуск)
    - [Требования](#требования)
    - [Установка зависимостей](#установка-зависимостей)
    - [Настройка окружения](#настройка-окружения)
    - [Запуск](#запуск)
  - [Тестирование](#тестирование)
  - [Миграции базы данных](#миграции-базы-данных)
  - [Линтинг и форматирование](#линтинг-и-форматирование)
  - [Особенности реализации](#особенности-реализации)

## Архитектура проекта

Проект следует принципам чистой архитектуры, которая разделяет код на несколько слоев:

### Преимущества чистой архитектуры

1. **Независимость от фреймворков** — архитектура не зависит от наличия каких-либо библиотек или фреймворков.
2. **Тестируемость** — бизнес-правила могут быть протестированы без UI, базы данных или любых внешних элементов.
3. **Независимость от UI** — UI можно легко изменить, не меняя остальную систему.
4. **Независимость от БД** — бизнес-правила не связаны с базой данных, поэтому можно легко заменить PostgreSQL на MongoDB или любую другую БД.
5. **Независимость от внешних агентов** — бизнес-правила ничего не знают о внешнем мире.

### Слои архитектуры

1. **Domain** — бизнес-сущности, интерфейсы репозиториев, исключения и DTO.
2. **Application** — сценарии использования (Use Cases) приложения.
3. **Infrastructure** — реализация репозиториев, работа с БД, внешние сервисы.
4. **Presentation** — API интерфейсы, обработчики запросов, роутеры.

## Структура проекта

```
app/
├── application/
│   └── use_cases/  # Use Cases приложения
│       ├── auth/   # Авторизация и работа с токенами
│       └── users/  # Работа с пользователями
├── domain/         # Доменный слой
│   ├── dto/        # Объекты передачи данных
│   ├── entities/   # Бизнес-сущности
│   ├── exceptions/ # Доменные исключения
│   └── interfaces/ # Интерфейсы репозиториев и сервисов
├── infrastructure/ # Инфраструктурный слой
│   ├── config/     # Конфигурация приложения
│   ├── database/   # Работа с базой данных
│   │   ├── models/ # ORM модели
│   │   └── repositories/ # Реализации репозиториев
│   ├── logging/    # Логирование
│   └── services/   # Реализации сервисов
└── presentation/   # Представительский слой
    ├── api/        # API эндпоинты
    │   ├── private/ # Приватные эндпоинты (требуют авторизации)
    │   └── public/  # Публичные эндпоинты
    └── schemas/    # Pydantic модели для валидации запросов/ответов

migrations/        # Миграции базы данных
tests/             # Тесты
```

## Основные функции

- **Регистрация и авторизация пользователей**
- **Управление токенами доступа и обновления**
- **Обновление токенов**
- **Выход из системы**

## API Endpoints

### Публичные эндпоинты

- **POST /api/users/register** - Регистрация нового пользователя
- **POST /api/auth/login** - Авторизация пользователя
- **PATCH /api/auth/refresh** - Обновление токенов

### Приватные эндпоинты (требуют авторизации)

- **DELETE /api/auth/logout** - Выход из системы (удаление сессии)
- **GET  /api/users/me** - Получение текущего пользователя

## Установка и запуск

### Требования

- Python 3.13.2+
- PostgreSQL

### Установка зависимостей

```bash
# С использованием uv
make install
```

### Настройка окружения

1. Создайте файл `.env` в корне проекта
2. Заполните его необходимыми переменными окружения:

```
.env.example -> .env
```

### Запуск

```bash
make run
```

Приложение будет доступно по адресу http://localhost:8000

## Тестирование

Проект содержит юнит-тесты для обеспечения качества кода:

```bash
# Запуск всех тестов
make test

# Запуск тестов с подробным выводом
make pytest
```

## Миграции базы данных

Управление схемой базы данных осуществляется с помощью Alembic:

```bash
# Создание новой миграции
make alembic-revision message="Migration description"

# Применение миграций
make alembic-upgrade

# Откат миграций
make alembic-downgrade steps=1
```

## Линтинг и форматирование

Проект использует современные инструменты для обеспечения качества кода:

```bash
# Проверка кода линтером
make lint

# Автоматическое форматирование кода
make format
```

## Особенности реализации

- **Unit of Work** паттерн для управления транзакциями
- **Repository** паттерн для абстракции работы с БД
- **DTO** (Data Transfer Objects) для передачи данных между слоями
- **JWT** для безопасной аутентификации
- **Dependency Injection** для обеспечения гибкости и тестируемости